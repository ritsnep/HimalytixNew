{% extends "base.html" %}
{% load static %}

{% block page_content %}
<div class="page-content py-3">
  <div class="container-fluid">

    <div class="card shadow-sm card-compact">
      <div class="card-body">

        {% include "vouchers/sales_invoice/partials/_page_header.html" %}

        <form id="sales-invoice-form"
              method="post"
              action="{{ draft.id|default_if_none:''|urlencode }}"
              hx-post="{% url 'vouchers_sales_invoice:recalc' draft_id=draft.id %}"
              hx-trigger="input changed delay:400ms, change delay:200ms"
              hx-sync="closest form:abort"
              hx-target="#recalc-sink"
              hx-swap="innerHTML"
              novalidate>
          {% csrf_token %}
          <input type="hidden" name="draft_id" value="{{ draft.id }}">

          {% include "vouchers/sales_invoice/partials/_header_grid.html" %}

          {% include "vouchers/sales_invoice/partials/_column_toggles.html" %}

          <div class="row g-3">
            <div class="col-xl-8">
              {% include "vouchers/sales_invoice/partials/_items_table.html" %}
            </div>
            <div class="col-xl-4">
              {% include "vouchers/sales_invoice/partials/_totals_panel.html" %}
            </div>
          </div>

          <div class="row g-3 mt-1">
            <div class="col-lg-6">
              {% include "vouchers/sales_invoice/partials/_terms_panel.html" %}
            </div>
            <div class="col-lg-6">
              {% include "vouchers/sales_invoice/partials/_receipt_panel.html" %}
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">Narration</label>
            <textarea class="form-control form-control-sm" name="narration" id="narration" rows="2" placeholder="Optional narration...">{{ draft.narration }}</textarea>
          </div>

          <div id="recalc-sink" class="d-none"></div>

        </form>
      </div>
      {% include "vouchers/sales_invoice/partials/_sticky_actions.html" %}
    </div>
  </div>
</div>
{% endblock page_content %}
