{% load static %}
<div class="card beta-summary" id="beta-order-summary">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
                <h5 class="mb-1">Purchase Order</h5>
                <div class="small text-muted text-uppercase">Vendor</div>
            </div>
            <span class="beta-pill text-warning d-inline-flex align-items-center gap-1">
                <i class="mdi mdi-alert-circle-outline"></i>
                {{ payment_status }}
            </span>
        </div>

        <form class="mb-3"
              hx-post="{% url 'pages:beta.purchase_cart' %}"
              hx-target="#beta-order-summary"
              hx-swap="outerHTML">
            {% csrf_token %}
            <div class="input-group input-group-sm">
                <select class="form-select" name="vendor">
                    {% for option in vendors %}
                    <option value="{{ option }}" {% if option == vendor %}selected{% endif %}>{{ option }}</option>
                    {% endfor %}
                </select>
                <button class="btn btn-outline-secondary" type="submit">Update</button>
            </div>
        </form>

        <div class="beta-line-stack mb-3">
            {% for line in order_lines %}
            <div class="border rounded p-3 mb-2">
                <div class="d-flex justify-content-between gap-2 align-items-start">
                    <div class="flex-grow-1">
                        <div class="text-uppercase text-muted small fw-semibold">{{ line.sku }}</div>
                        <div class="fw-semibold">{{ line.name }}</div>
                        <div class="small text-muted">Unit Cost: ${{ line.unit_cost|floatformat:2 }}</div>
                    </div>
                    <form hx-post="{% url 'pages:beta.purchase_cart' %}"
                          hx-target="#beta-order-summary"
                          hx-swap="outerHTML"
                          class="d-flex align-items-start gap-2">
                        {% csrf_token %}
                        <input type="hidden" name="sku" value="{{ line.sku }}">
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-secondary" type="submit" name="action" value="decrement">-</button>
                            <button class="btn btn-light" type="button" disabled>{{ line.quantity }}</button>
                            <button class="btn btn-outline-secondary" type="submit" name="action" value="add">+</button>
                        </div>
                        <button class="btn btn-link text-danger px-0" type="submit" name="action" value="remove">
                            <i class="mdi mdi-trash-can-outline"></i>
                        </button>
                    </form>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <span class="text-muted small">Qty {{ line.quantity }} x ${{ line.unit_cost|floatformat:2 }}</span>
                    <span class="fw-semibold">${{ line.line_total|floatformat:2 }}</span>
                </div>
            </div>
            {% empty %}
            <div class="border rounded p-3 text-center text-muted">
                Add a product from the grid to build a purchase order.
            </div>
            {% endfor %}
        </div>

        <div class="d-flex align-items-center justify-content-between mb-3">
            <span class="beta-pill bg-soft-success text-success">Cash / Paid</span>
            <span class="beta-pill bg-soft-warning text-warning">Payment Due</span>
        </div>

        <div class="bg-light p-3 rounded mb-3">
            <div class="d-flex justify-content-between small mb-2">
                <span>Subtotal</span>
                <span>${{ subtotal|floatformat:2 }}</span>
            </div>
            <div class="d-flex justify-content-between small mb-2">
                <span>Est. Sales Tax ({{ tax_rate }}%)</span>
                <span>${{ sales_tax|floatformat:2 }}</span>
            </div>
            <div class="d-flex align-items-center gap-2 mb-2">
                <input type="text" class="form-control form-control-sm" placeholder="Charge Name" disabled>
                <input type="number" class="form-control form-control-sm" placeholder="Amount" disabled>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <span class="fw-semibold">Total Cost</span>
                <div class="text-end">
                    <div class="h4 mb-0">${{ grand_total|floatformat:2 }}</div>
                    <small class="text-muted">{{ order_lines|length }} item{{ order_lines|length|pluralize }}</small>
                </div>
            </div>
        </div>

        <button class="btn btn-primary w-100" type="button">
            Process Order <i class="mdi mdi-arrow-right ms-1"></i>
        </button>
    </div>
</div>
