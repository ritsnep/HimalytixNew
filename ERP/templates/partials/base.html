{% load static %}
<!DOCTYPE html>
<html lang="{{ current_language|default:'en' }}">

<head>
    <meta charset="utf-8" />
    <title>{% block title %}{% endblock title %} | Dason - Admin & Dashboard Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesdesign" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="{{ branding.favicon_url }}">

    {% block css %}
    {% block extra_css %}
    {% endblock extra_css %}
    <!-- preloader css -->
    <link rel="stylesheet" href="{% static 'css/preloader.min.css'%}" type="text/css" />

    <!-- Bootstrap Css -->
    <link href="{% static 'css/bootstrap.min.css'%}" id="bootstrap-style" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="{% static 'css/icons.min.css'%}" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="{% static 'css/app.min.css'%}" id="app-style" rel="stylesheet" type="text/css" />
    <!-- Toastr CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" type="text/css" />
    {% endblock css %}

</head>

<body {% block extra_body %} data-topbar="dark"{% endblock extra_body %}>
  {# Hidden layout controls to prevent vendor script null errors on pages without right sidebar #}
  <div id="layout-guard" style="display:none">
    <input type="checkbox" id="layout-horizontal" />
    <input type="checkbox" id="layout-vertical" />
    <input type="checkbox" id="layout-mode-dark" />
    <input type="checkbox" id="layout-mode-light" />
    <input type="checkbox" id="layout-width-boxed" />
    <input type="checkbox" id="layout-width-fuild" />
    <input type="checkbox" id="layout-position-scrollable" />
    <input type="checkbox" id="layout-position-fixed" />
    <input type="checkbox" id="topbar-color-dark" />
    <input type="checkbox" id="topbar-color-light" />
    <input type="checkbox" id="sidebar-size-small" />
    <input type="checkbox" id="sidebar-size-compact" />
    <input type="checkbox" id="sidebar-size-default" />
    <input type="checkbox" id="sidebar-color-brand" />
    <input type="checkbox" id="sidebar-color-dark" />
    <input type="checkbox" id="sidebar-color-light" />
    <input type="checkbox" id="layout-direction-rtl" />
    <input type="checkbox" id="layout-direction-ltr" />
  </div>
    <!-- Begin page -->
    <div id="layout-wrapper">
        {% block header %}
        {% include "partials/header.html" %}
        {% endblock header %}

        {% block left_sidebar %}
        {% include 'partials/left-sidebar.html' %}
        {% endblock left_sidebar %}


        <main class="flex-grow-1">
            {% block content %}
            {# Django messages block #}
            {% if messages %}
              <div class="container mt-2">
                <ul class="list-unstyled">
                  {% for message in messages %}
                    <li class="alert alert-{{ message.tags }}">{{ message }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
            {% block footer %}
            {% endblock footer %}
            {% endblock content %}
        </main>
    </div>
    <!-- END layout-wrapper -->


    {% block right_sidebar %}
        {% if user.is_staff and not voucher_entry_page %}
            {% include 'partials/right-sidebar.html' %}
        {% endif %}
    {% endblock right_sidebar %}


    {% block javascript %}
    <!-- JAVASCRIPT -->
    <script src="{% static 'libs/jquery/dist/jquery.min.js'%}"></script>
    <script src="{% static 'libs/bootstrap/dist/js/bootstrap.bundle.min.js'%}"></script>
    <script src="{% static 'libs/metismenu/dist/metisMenu.min.js'%}"></script>
    <script src="{% static 'libs/simplebar/dist/simplebar.min.js'%}"></script>
    <script src="{% static 'libs/node-waves/dist/waves.min.js'%}"></script>
    <script src="{% static 'libs/feather-icons/dist/feather.min.js'%}"></script>
    <!-- pace js -->
    <script src="{% static 'libs/pace-js/pace.min.js'%}"></script>
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <!-- Pristine.js (local) to avoid CDN/tracking blocks -->
    <script src="{% static 'libs/pristinejs/dist/pristine.min.js' %}"></script>
    <!-- Toastr -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    {% block extra_js %}
    {% endblock extra_js %}
    {# Expose i18n to JS safely #}
    <script id="i18n-json" type="application/json">{{ i18n|json_script:"i18n-json" }}</script>
    <script>
      (function(){
        try {
          var node = document.getElementById('i18n-json');
          var raw = node ? node.textContent : '{}';
          window.I18N = JSON.parse(raw || '{}');
        } catch (e) {
          window.I18N = {};
        }
        window.CURRENT_LANGUAGE = '{{ current_language|default:"en" }}';
        window.CURRENT_REGION = '{{ current_region|default:"US" }}';
        window.t = function(key, fallback){
          if (window.I18N && Object.prototype.hasOwnProperty.call(window.I18N, key)) return window.I18N[key];
          return fallback || key;
        };
      })();
    </script>
    <script src="{% static 'js/app.js'%}"></script>

    <script>
        // Configure toastr
        toastr.options = {
            "closeButton": true,
            "debug": false,
            "newestOnTop": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": false,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "1000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        // HTMX Toast Notifications
        document.body.addEventListener('showMessage', function(evt) {
            const message = evt.detail.message;
            const type = evt.detail.type || 'success';
            toastr[type](message);
        });
    </script>
    {% endblock javascript %}
</body>

</html>
