{% extends "inventory/_list_base.html" %}
{% load static %}

{% block title %}Inventory Dashboard{% endblock %}
{% extends "partials/base.html" %}
{% block title %}Inventory Dashboard{% endblock %}

{% block content %}
<div class="page-heading d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-0">Inventory Dashboard</h3>
    <p class="text-muted mb-0">Overview of inventory performance and quick actions.</p>
  </div>
  <div class="btn-group">
    <a href="{% url 'inventory:product_create' %}" class="btn btn-success btn-sm">
      <i class="mdi mdi-plus me-1"></i> Add Product
    </a>
    <a href="{% url 'inventory:warehouse_create' %}" class="btn btn-primary btn-sm">
      <i class="mdi mdi-plus me-1"></i> Add Warehouse
    </a>
  </div>
</div>

<div class="row">
  {% for card in cards %}
    <div class="col-sm-6 col-xl-3 mb-3">
      <div class="card h-100">
        <div class="card-body text-center">
          <i class="mdi {{ card.icon }} text-{{ card.color }}" style="font-size: 2.5rem;"></i>
          <h6 class="mt-3 mb-1">{{ card.title }}</h6>
          <h3 class="mb-0">{{ card.value }}</h3>
          <p class="text-muted mb-0">{{ card.description }}</p>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

<div class="card mt-4">
  <div class="card-header">
    <h5 class="card-title mb-0">Quick Actions</h5>
  </div>
  <div class="card-body">
    <div class="row g-2">
      {% for action in quick_actions %}
        <div class="col-sm-6 col-md-4 col-lg-3">
          <a href="{% url action.url %}" class="btn btn-outline-secondary w-100">
            <i class="mdi {{ action.icon }} me-1"></i> {{ action.label }}
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
<div class="row mt-4">
  <div class="col-lg-4 col-md-6 mb-3">
    <div class="card h-100">
      <div class="card-body">
        <h6 class="card-title">Reorder Alerts</h6>
        <h3 class="mb-2">{{ reorder_summary.count }}</h3>
        <p class="text-muted mb-0">Shortage: {{ reorder_summary.shortage|floatformat:2 }}</p>
      </div>
    </div>
  </div>
  <div class="col-lg-8 col-md-6 mb-3">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h6 class="card-title mb-0">Shortage by Warehouse</h6>
            <p class="text-muted mb-0">Top warehouses needing stock</p>
          </div>
          <a href="{% url 'inventory:reorder_recommendation_list' %}" class="btn btn-sm btn-outline-primary">
            View Recommendations
          </a>
        </div>
        <canvas id="reorderChart" height="160"></canvas>
        <script id="reorder-data" type="application/json">{{ reorder_chart_data|json_script:"reorder-data" }}</script>
      </div>
    </div>
  </div>
</div>
{% block extra_js %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const chartEl = document.getElementById('reorderChart');
      if (!chartEl) return;
      const raw = document.getElementById('reorder-data');
      const data = raw ? JSON.parse(raw.textContent || '[]') : [];
      if (!data.length) return;
      const labels = data.map(item => item['warehouse__code']);
      const values = data.map(item => item.total_shortage || 0);
      new Chart(chartEl, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Shortage',
            data: values,
            backgroundColor: '#fb7185',
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            x: { title: { display: true, text: 'Warehouse' } },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Shortage Qty' }
            }
          }
        }
      });
    });
  </script>
{% endblock %}
{% endblock %}
    </div>
  </div>
</div>
{% endblock %}
