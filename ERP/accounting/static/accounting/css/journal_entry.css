/**
 * Journal Entry Stylesheet
 *
 * This file contains all styles for the Excel-like journal entry interface.
 * It is structured to be maintainable and follows a BEM-like methodology
 * scoped within the #journal-entry container.
 *
 * Structure:
 * 1. Variables & Resets
 * 2. Layout & Containers
 * 3. Grid (Header/Body/Cells)
 * 4. Inline Editing & States
 * 5. Tooltips
 * 6. Pills & Buttons
 * 7. Side Panel
 * 8. Footer Totals
 * 9. Responsiveness & Utilities
 * 10. Dark Mode & Reduced Motion
 */

/* ==========================================================================
   1. Variables & Resets
   ========================================================================== */

#journal-entry {
  /* Color Palette */
  --c-text-primary: #1a1a1a;
  --c-text-secondary: #555;
  --c-text-disabled: #999;
  --c-text-accent: #005fcc;
  --c-text-on-accent: #ffffff;
  --c-text-error: #d92a2a;

  --c-bg-primary: #ffffff;
  --c-bg-secondary: #f5f5f5;
  --c-bg-hover: #eef5ff;
  --c-bg-selected: #dbe9ff;
  --c-bg-dirty: #fffbe6; /* Subtle yellow for dirty rows */
  --c-bg-accent: #007bff;

  --c-border-primary: #d1d1d1;
  --c-border-focus: #007bff;
  --c-border-error: #d92a2a;
  --c-border-divider: #e0e0e0;

  --c-pill-ok-bg: #e7f5e7;
  --c-pill-ok-text: #2a7d2a;
  --c-pill-warn-bg: #fffbe6;
  --c-pill-warn-text: #b58a00;
  --c-pill-error-bg: #fdecec;
  --c-pill-error-text: #d92a2a;
  --c-pill-currency-bg: #e0e0e0;
  --c-pill-currency-text: #333;

  /* Typography */
  --font-family-sans: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  --font-family-mono: 'SF Mono', 'Consolas', 'Liberation Mono', Menlo, monospace;
  --font-size-sm: 0.875rem; /* 14px */
  --font-size-base: 1rem; /* 16px */
  --font-weight-normal: 400;
  --font-weight-bold: 600;

  /* Spacing & Sizing */
  --space-xs: 0.25rem;  /* 4px */
  --space-sm: 0.5rem;   /* 8px */
  --space-md: 1rem;     /* 16px */
  --space-lg: 1.5rem;   /* 24px */
  --touch-target: 44px;

  /* Borders & Radii */
  --border-radius-sm: 3px;
  --border-radius-md: 5px;
  --border-width: 1px;

  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);

  /* Transitions */
  --transition-duration: 150ms;
  --transition-timing: ease-in-out;
  --transition-main: all var(--transition-duration) var(--transition-timing);

  /* Reset Styles */
  box-sizing: border-box;
  font-family: var(--font-family-sans);
  color: var(--c-text-primary);
}

#journal-entry *,
#journal-entry *::before,
#journal-entry *::after {
  box-sizing: inherit;
}

/* ==========================================================================
   2. Layout & Containers
   ========================================================================== */

#journal-entry {
  display: flex;
  height: 100vh; /* Or a specific height */
  background-color: var(--c-bg-primary);
}

#journal-entry .je-grid-container {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

#journal-entry .je-grid {
  flex-grow: 1;
  overflow: auto; /* Allows grid to scroll independently */
  position: relative;
}

/* ==========================================================================
   3. Grid (Header/Body/Cells)
   ========================================================================== */

#journal-entry .je-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

#journal-entry .je-header {
  position: sticky;
  top: 0;
  z-index: 10;
  background-color: var(--c-bg-secondary);
  box-shadow: var(--shadow-sm);
}

#journal-entry .je-header th {
  padding: var(--space-sm) var(--space-md);
  font-weight: var(--font-weight-bold);
  text-align: left;
  border-bottom: var(--border-width) solid var(--c-border-primary);
}

#journal-entry .je-body tr:nth-child(even) {
  background-color: var(--c-bg-secondary);
}

#journal-entry .je-body tr:hover {
  background-color: var(--c-bg-hover);
}

#journal-entry .je-body tr.is-selected {
  background-color: var(--c-bg-selected);
  font-weight: var(--font-weight-bold);
}

#journal-entry .je-cell {
  padding: 0; /* Padding is handled by the inner div/input */
  border-bottom: var(--border-width) solid var(--c-border-divider);
  position: relative;
  vertical-align: middle;
}

#journal-entry .cell-content {
  padding: var(--space-sm) var(--space-md);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-height: var(--touch-target);
  display: flex;
  align-items: center;
}

/* Right-align numbers */
#journal-entry .cell--debit,
#journal-entry .cell--credit,
#journal-entry .cell--rate {
  text-align: right;
}

#journal-entry .cell--debit .cell-content,
#journal-entry .cell--credit .cell-content,
#journal-entry .cell--rate .cell-content {
  justify-content: flex-end;
  font-variant-numeric: tabular-nums;
}

/* Truncate long text and show tooltip on hover */
#journal-entry .cell-content[data-tooltip]:hover {
  cursor: help;
}

/* ==========================================================================
   4. Inline Editing & States
   ========================================================================== */

#journal-entry .cell-input {
  width: 100%;
  height: 100%;
  padding: var(--space-sm) var(--space-md);
  border: var(--border-width) solid transparent;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  color: inherit;
  outline: none;
  min-height: var(--touch-target);
}

#journal-entry .cell-input:focus,
#journal-entry .cell-input:focus-visible {
  border-color: var(--c-border-focus);
  background-color: var(--c-bg-primary);
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

/* Dirty state for rows */
#journal-entry .je-body tr.is-dirty {
  background-color: var(--c-bg-dirty);
}

/* Invalid state for cells/rows */
#journal-entry .je-body tr.is-invalid .je-cell,
#journal-entry .je-cell.is-invalid {
  position: relative;
}

#journal-entry .je-cell.is-invalid .cell-content {
  border: var(--border-width) solid var(--c-border-error);
  border-radius: var(--border-radius-sm);
}

#journal-entry .je-cell.is-invalid .cell-input {
  border-color: var(--c-border-error);
}

#journal-entry .je-cell.is-invalid .cell-input:focus {
  box-shadow: 0 0 0 2px rgba(217, 42, 42, 0.25);
}

/* ==========================================================================
   5. Tooltips
   ========================================================================== */

#journal-entry [data-tooltip] {
  position: relative;
}

#journal-entry [data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background-color: var(--c-text-secondary);
  color: var(--c-bg-primary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: opacity var(--transition-duration) var(--transition-timing),
              visibility var(--transition-duration) var(--transition-timing);
  z-index: 20;
}

#journal-entry [data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
}

#journal-entry .is-invalid[data-tooltip]::after {
  background-color: var(--c-border-error);
}

/* ==========================================================================
   6. Pills & Buttons
   ========================================================================== */

#journal-entry .pill {
  display: inline-block;
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-bold);
  border-radius: var(--border-radius-md);
  line-height: 1.2;
}

#journal-entry .pill--ok {
  background-color: var(--c-pill-ok-bg);
  color: var(--c-pill-ok-text);
}

#journal-entry .pill--warn {
  background-color: var(--c-pill-warn-bg);
  color: var(--c-pill-warn-text);
}

#journal-entry .pill--error {
  background-color: var(--c-pill-error-bg);
  color: var(--c-pill-error-text);
}

#journal-entry .pill--currency {
  background-color: var(--c-pill-currency-bg);
  color: var(--c-pill-currency-text);
}

#journal-entry .icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: calc(var(--touch-target) - 8px);
  height: calc(var(--touch-target) - 8px);
  margin: 0 var(--space-xs);
  border: none;
  background-color: transparent;
  color: var(--c-text-secondary);
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition-main);
}

#journal-entry .icon-btn:hover {
  background-color: var(--c-bg-hover);
  color: var(--c-text-accent);
}

#journal-entry .icon-btn:active {
  background-color: var(--c-bg-selected);
}

#journal-entry .icon-btn:focus-visible {
  outline: 2px solid var(--c-border-focus);
  outline-offset: 1px;
}

#journal-entry .icon-btn:disabled {
  color: var(--c-text-disabled);
  background-color: transparent;
  cursor: not-allowed;
}

#journal-entry .icon-btn.delete:hover {
  background-color: var(--c-pill-error-bg);
  color: var(--c-text-error);
}

/* ==========================================================================
   7. Side Panel
   ========================================================================== */

#journal-entry .je-sidepanel {
  flex-shrink: 0;
  width: 320px;
  border-left: var(--border-width) solid var(--c-border-divider);
  padding: var(--space-lg);
  overflow-y: auto;
  background-color: var(--c-bg-secondary);
}

#journal-entry .sp-group {
  margin-bottom: var(--space-lg);
}

#journal-entry .sp-label {
  display: block;
  font-weight: var(--font-weight-bold);
  margin-bottom: var(--space-sm);
  color: var(--c-text-secondary);
}

#journal-entry .sp-input,
#journal-entry .sp-select,
#journal-entry .sp-textarea {
  width: 100%;
  padding: var(--space-sm);
  border: var(--border-width) solid var(--c-border-primary);
  border-radius: var(--border-radius-md);
  background-color: var(--c-bg-primary);
  font-size: var(--font-size-base);
  transition: var(--transition-main);
}

#journal-entry .sp-input:focus,
#journal-entry .sp-select:focus,
#journal-entry .sp-textarea:focus {
  outline: none;
  border-color: var(--c-border-focus);
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

#journal-entry .sp-textarea {
  min-height: 80px;
  resize: vertical;
}

/* ==========================================================================
   8. Footer Totals
   ========================================================================== */

#journal-entry .je-footer {
  position: sticky;
  bottom: 0;
  z-index: 10;
  display: flex;
  justify-content: flex-end;
  padding: var(--space-md);
  background-color: var(--c-bg-secondary);
  border-top: var(--border-width) solid var(--c-border-primary);
  font-weight: var(--font-weight-bold);
}

#journal-entry .je-footer-item {
  margin-left: var(--space-lg);
  min-width: 120px;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#journal-entry .je-footer-label {
  color: var(--c-text-secondary);
  margin-right: var(--space-sm);
}

/* ==========================================================================
   9. Responsiveness & Utilities
   ========================================================================== */

@media (max-width: 768px) {
  #journal-entry {
    flex-direction: column;
  }

  #journal-entry .je-sidepanel {
    width: 100%;
    border-left: none;
    border-top: var(--border-width) solid var(--c-border-divider);
    max-height: 50vh; /* Or other appropriate value */
  }

  #journal-entry .je-grid-container:not(.show-all) .cell--proj,
  #journal-entry .je-grid-container:not(.show-all) .cell--cc,
  #journal-entry .je-grid-container:not(.show-all) .cell--rate,
  #journal-entry .je-grid-container:not(.show-all) .cell--status {
    display: none;
  }
}

/* Utility to force visibility on small screens */
#journal-entry .show-all .je-cell {
  display: table-cell !important;
}

/* ==========================================================================
   10. Dark Mode & Reduced Motion
   ========================================================================== */

@media (prefers-color-scheme: dark) {
  #journal-entry {
    --c-text-primary: #e0e0e0;
    --c-text-secondary: #a0a0a0;
    --c-text-disabled: #777;
    --c-text-accent: #58a6ff;
    --c-text-on-accent: #0d1117;
    --c-text-error: #ff8989;

    --c-bg-primary: #1c1c1e;
    --c-bg-secondary: #2c2c2e;
    --c-bg-hover: #3a3a3c;
    --c-bg-selected: #4a4a4c;
    --c-bg-dirty: #4d441a;
    --c-bg-accent: #58a6ff;

    --c-border-primary: #444;
    --c-border-focus: #58a6ff;
    --c-border-error: #ff8989;
    --c-border-divider: #3a3a3c;

    --c-pill-ok-bg: #2a4b2a;
    --c-pill-ok-text: #90ee90;
    --c-pill-warn-bg: #4d441a;
    --c-pill-warn-text: #f0e68c;
    --c-pill-error-bg: #5b2a2a;
    --c-pill-error-text: #ff8989;
    --c-pill-currency-bg: #444;
    --c-pill-currency-text: #e0e0e0;
  }
}

@media (prefers-reduced-motion: reduce) {
  #journal-entry,
  #journal-entry *,
  #journal-entry *::before,
  #journal-entry *::after {
    transition-duration: 0.01ms !important;
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    scroll-behavior: auto !important;
  }
}
