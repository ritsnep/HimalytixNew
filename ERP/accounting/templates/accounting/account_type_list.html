{% extends 'accounting/_list_base.html' %}
{% load static %}

{% block title %}Account Types{% endblock %}
{% block breadcrumb %}Account Types{% endblock %}
{% block add_url %}{% url 'accounting:account_type_create' %}{% endblock %}

{% block list_header %}
<h4 class="card-title">Account Types</h4>
{% endblock %}

{% block create_button %}
<div class="d-flex align-items-center gap-2 flex-wrap">
    <a href="{% url 'accounting:account_type_create' %}" class="btn btn-success btn-sm">
        <i class="mdi mdi-plus me-1"></i> New Account Type
    </a>
    <div class="input-group input-group-sm" style="width: 320px;">
        <label class="input-group-text" for="bulk-action">Bulk</label>
        <select id="bulk-action" name="action" class="form-select form-select-sm" form="bulk-action-form">
            <option value="">Select action</option>
            <option value="activate">Mark Active</option>
            <option value="deactivate">Mark Inactive</option>
        </select>
        <button id="bulk-action-apply" type="submit" class="btn btn-outline-primary" form="bulk-action-form">Apply</button>
    </div>
</div>
{% endblock %}

{% block table_head %}
<thead>
    <tr>
        <th class="no-search no-export" style="width:30px;"><input type="checkbox" id="select-all" class="form-check-input form-check-sm"></th>
        <th>Code</th>
        <th>Name</th>
        <th>Nature</th>
        <th>Classification</th>
        <th>Balance Sheet Category</th>
        <th>Income Statement Category</th>
        <th>Cash Flow Category</th>
        <th>Display Order</th>
        <th>Root Code Prefix</th>
        <th>Root Code Step</th>
        <th>System Type</th>
        <th>Archived</th>
        <th>Action</th>
    </tr>
</thead>
{% endblock %}

{% block table_body %}
<tbody>
    {% if is_grouped %}
        {% for values in group_values %}
        <tr>
            {% for value in values %}
            <td>{{ value }}</td>
            {% endfor %}
            <td colspan="11">Grouped by {{ group_by_fields|join:", " }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="14">No grouped data found.</td></tr>
        {% endfor %}
    {% else %}
        {% for type in object_list %}
        <tr data-pk="{{ type.pk }}">
            <td><input type="checkbox" class="form-check-input row-select" name="selected_ids" value="{{ type.pk }}" form="bulk-action-form"></td>
            <td>{{ type.code }}</td>
            <td>{{ type.name }}</td>
            <td>{{ type.nature }}</td>
            <td>{{ type.classification }}</td>
            <td>{{ type.balance_sheet_category }}</td>
            <td>{{ type.income_statement_category }}</td>
            <td>{{ type.cash_flow_category }}</td>
            <td>{{ type.display_order }}</td>
            <td>{{ type.root_code_prefix }}</td>
            <td>{{ type.root_code_step }}</td>
            <td>{{ type.system_type|yesno:"Yes,No" }}</td>
            <td>{{ type.is_archived|yesno:"Yes,No" }}</td>
            <td>
                <a href="{% url 'accounting:account_type_update' type.pk %}" class="btn btn-sm btn-primary">Edit</a>
                <a href="{% url 'accounting:account_type_delete' type.pk %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this account type?');">Delete</a>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="14">No account types found.</td></tr>
        {% endfor %}
    {% endif %}
</tbody>
{% endblock %} 

{% block custom_filters %}
<form id="bulk-action-form" method="post">
    {% csrf_token %}
</form>
{% endblock %}

{% block extra_js %}
<script id="datatable-config" type="application/json">
{
    "columnDefs": [
        {"targets": [0, -1], "orderable": false, "searchable": false}
    ]
}
</script>
{{ block.super }}
<script>
    $(function() {
        var selectAll = $('#select-all');
        var rowChecks = $('input.row-select');
        var actionSelect = $('#bulk-action');
        var applyBtn = $('#bulk-action-apply');

        function syncSelectAll() {
            var checkedCount = rowChecks.filter(':checked').length;
            selectAll.prop('checked', checkedCount > 0 && checkedCount === rowChecks.length);
        }

        selectAll.on('change', function() {
            rowChecks.prop('checked', $(this).is(':checked'));
        });

        rowChecks.on('change', syncSelectAll);

        applyBtn.on('click', function(e) {
            if (!actionSelect.val()) {
                e.preventDefault();
                alert('Choose a bulk action to apply.');
                return;
            }
            if (!rowChecks.filter(':checked').length) {
                e.preventDefault();
                alert('Select at least one item.');
            }
        });
    });
</script>
{% endblock %}
