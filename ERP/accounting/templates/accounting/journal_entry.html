{% extends "partials/base.html" %}
{% load static %}

{% block title %}Voucher Entry{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounting/css/voucher_entry.css' %}">
<link rel="stylesheet" href="{% static 'accounting/css/voucher_entry_dason.css' %}">
<link rel="stylesheet" href="{% static 'accounting/css/voucher_entry_glass.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid py-3 ve-page-content">
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-0">Voucher Workspace</h4>
      <small class="text-muted">
        {% if active_config_name %}
          {{ active_config_name }}
        {% else %}
          Schema-driven journal & transaction entry
        {% endif %}
      </small>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <a href="{{ config_selector_url }}" class="btn btn-outline-secondary btn-sm">
        <i class="mdi mdi-cog-outline me-1"></i>Change Configuration
      </a>
      <a href="{% url 'accounting:voucher_list' %}" class="btn btn-outline-primary btn-sm">
        <i class="mdi mdi-view-list-outline me-1"></i>Voucher List
      </a>
    </div>
  </div>

  <div
    id="app"
    class="card shadow-sm ve-app mb-3"
    data-endpoint-save="{{ save_endpoint }}"
    data-endpoint-submit="{{ submit_endpoint }}"
    data-endpoint-approve="{{ approve_endpoint }}"
    data-endpoint-reject="{{ reject_endpoint }}"
    data-endpoint-post="{{ post_endpoint }}"
    data-endpoint-period-validate="{{ period_validate_endpoint }}"
    data-default-journal-type="{{ journal_default_type }}"
    data-initial-journal-id="{{ initial_journal_id }}"
    data-detail-url-template="{{ detail_url_template }}"
    data-supported-currencies="{{ supported_currencies|join:',' }}"
    data-default-currency="{{ default_currency|default:'' }}"
    data-default-date="{{ default_date|default:'' }}"
    data-lookup-account="{{ lookup_urls.account|default:'' }}"
    data-lookup-cost-center="{{ lookup_urls.costCenter|default:'' }}"
    data-lookup-department="{{ lookup_urls.department|default:'' }}"
    data-lookup-project="{{ lookup_urls.project|default:'' }}"
    data-lookup-tax-code="{{ lookup_urls.taxCode|default:'' }}"
    data-lookup-vendor="{{ lookup_urls.vendor|default:'' }}"
    data-lookup-customer="{{ lookup_urls.customer|default:'' }}"
    data-lookup-product="{{ lookup_urls.product|default:'' }}"
    data-prefs-url="{{ prefs_endpoint|default:'' }}"
    data-prefs-save-url="{{ prefs_save_endpoint|default:prefs_endpoint }}"
    data-attach-upload="{{ attachment_upload_endpoint|default:'' }}"
    data-attach-delete="{{ attachment_delete_endpoint|default:'' }}"
    data-payment-terms="{{ payment_terms_endpoint|default:'' }}"
    data-config-url="{{ config_endpoint|default:'' }}"
    data-can-submit="{{ permission_flags.can_submit|yesno:'true,false' }}"
    data-can-approve="{{ permission_flags.can_approve|yesno:'true,false' }}"
    data-can-reject="{{ permission_flags.can_reject|yesno:'true,false' }}"
    data-can-post="{{ permission_flags.can_post|yesno:'true,false' }}"
    data-can-edit="{{ permission_flags.can_edit|yesno:'true,false' }}"
    data-debug-enabled="{{ journal_debug_enabled|yesno:'true,false' }}"
  >
    <div class="card-body text-center py-5 text-muted">
      <div class="spinner-border text-primary mb-3" role="status" aria-hidden="true"></div>
      <p class="mb-0">Loading voucher workspace...</p>
    </div>
  </div>

  <div class="card{% if not journal_debug_enabled %} d-none{% endif %}" id="journal-debug-panel">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div>
        <strong>Debug Console</strong>
        <small class="text-muted d-block">Recent API calls & payloads</small>
      </div>
      <div class="btn-group btn-group-sm" role="group">
        <button type="button" class="btn btn-outline-secondary" id="journal-debug-copy">
          <i class="mdi mdi-content-copy"></i>Copy
        </button>
        <button type="button" class="btn btn-outline-secondary" id="journal-debug-download">
          <i class="mdi mdi-download"></i>Download
        </button>
        <button type="button" class="btn btn-outline-danger" id="journal-debug-clear">
          <i class="mdi mdi-trash-can-outline"></i>Clear
        </button>
      </div>
    </div>
    <div class="card-body" id="journal-debug-entries">
      <p class="text-muted mb-0 small">Logs will appear here once actions are performed.</p>
    </div>
  </div>
</div>

<form id="journal-csrf-helper" class="d-none">
  {% csrf_token %}
</form>
{% endblock %}

{% block extra_js %}
<script id="initial-config-json" type="application/json">{{ initial_config_json|default:"{}"|safe }}</script>
<script src="{% static 'accounting/js/voucher_entry.js' %}"></script>
{% endblock %}
