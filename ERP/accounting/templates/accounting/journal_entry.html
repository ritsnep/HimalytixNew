{% extends "partials/base.html" %}
{% load static %}

{% block title %}Journal Entry{% endblock title %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'accounting/css/voucher_entry.css' %}">
<link rel="stylesheet" href="{% static 'accounting/css/voucher_entry_dason.css' %}">
<style>
  #journal-debug-panel {
    font-size: 0.9rem;
  }
  #journal-debug-panel pre {
    background-color: #f8f9fa;
    border-radius: 0.35rem;
    padding: 0.75rem;
    max-height: 260px;
    overflow: auto;
    font-family: var(--bs-font-monospace, SFMono-Regular, Consolas, 'Liberation Mono', monospace);
    white-space: pre-wrap;
    margin-bottom: 0;
  }
  #journal-debug-entries {
    max-height: 320px;
    overflow-y: auto;
  }
</style>
{% endblock extra_css %}

{% block extra_js %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="{% static 'accounting/js/voucher_entry.js' %}" defer></script>
{% endblock extra_js %}

{% block content %}
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="page-title-box d-flex align-items-center justify-content-between">
            <h4 class="mb-0">Journal Entry</h4>
            <div class="page-title-right">
              <ol class="breadcrumb m-0">
                <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="{% url 'accounting:voucher_list' %}">Vouchers</a></li>
                <li class="breadcrumb-item active">Journal Entry</li>
              </ol>
            </div>
          </div>
        </div>
      </div>

      <!-- In-page alert region (messages appear just below the top bar) -->
      <div id="app-alerts" class="mb-3" aria-live="polite" aria-atomic="true"></div>

      {% if journal_debug_enabled %}
      <div id="journal-debug-panel" class="card border border-warning mb-3" role="region" aria-label="Journal entry debug log">
        <div class="card-header d-flex flex-wrap justify-content-between align-items-center gap-2">
          <div>
            <strong>Save Debugging</strong>
            <span class="text-muted d-block small">Every request & response is captured here while debug mode is enabled.</span>
          </div>
          <div class="btn-group btn-group-sm" role="group" aria-label="Debug log actions">
            <button type="button" class="btn btn-outline-secondary" id="journal-debug-copy">Copy</button>
            <button type="button" class="btn btn-outline-secondary" id="journal-debug-download">Download</button>
            <button type="button" class="btn btn-outline-secondary" id="journal-debug-clear">Clear</button>
          </div>
        </div>
        <div class="card-body p-3">
          <div id="journal-debug-entries" class="debug-log-entries" aria-live="polite"></div>
        </div>
      </div>
      {% endif %}

    <!-- Main Content Card -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div
              id="app"
              data-endpoint-save="{% url 'accounting:journal_save_draft' %}"
              data-endpoint-submit="{% url 'accounting:journal_submit' %}"
              data-endpoint-approve="{% url 'accounting:journal_approve' %}"
              data-endpoint-reject="{% url 'accounting:journal_reject' %}"
              data-endpoint-post="{% url 'accounting:journal_post' %}"
              data-endpoint-period-validate="{% url 'accounting:journal_period_validate' %}"
              data-config-url="{{ config_endpoint }}"
              data-lookup-account="{% url 'accounting:journal_account_lookup' %}"
              data-lookup-cost-center="{% url 'accounting:journal_cost_center_lookup' %}"
              data-prefs-url="{{ prefs_endpoint }}"
              data-prefs-save-url="{{ prefs_save_endpoint }}"
              data-attach-upload="{{ attachment_upload_endpoint }}"
              data-attach-delete="{{ attachment_delete_endpoint }}"
              data-payment-terms="{{ payment_terms_endpoint }}"
              data-default-journal-type="{{ journal_default_type }}"
              data-initial-journal-id="{{ initial_journal_id }}"
              data-detail-url-template="{{ detail_url_template }}"
              data-supported-currencies="{{ supported_currencies|join:',' }}"
              data-can-submit="{{ permission_flags.can_submit|yesno:'true,false' }}"
              data-can-approve="{{ permission_flags.can_approve|yesno:'true,false' }}"
              data-can-reject="{{ permission_flags.can_reject|yesno:'true,false' }}"
              data-can-post="{{ permission_flags.can_post|yesno:'true,false' }}"
              data-show-config-selector="{{ show_config_selector|yesno:'true,false' }}"
              data-debug-enabled="{{ journal_debug_enabled|yesno:'true,false' }}"
            ></div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>
</div>
<!-- END main-content -->

{# Removed in-page config modal; users are redirected to a dedicated selection page instead. #}
{% endblock content %}
