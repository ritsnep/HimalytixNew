<!-- Audit Trail Partial -->
<!-- Display history of all changes to the journal -->

<div class="card mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">Change History</h5>
    </div>

    <div class="card-body p-0">
        {% if audit_trail %}
            <div class="timeline">
                {% for entry in audit_trail %}
                    <div class="timeline-item {% if forloop.first %}active{% endif %}">
                        <div class="timeline-marker">
                            <i class="bi {% if entry.action == 'create' %}bi-plus-circle{% elif entry.action == 'update' %}bi-pencil-square{% elif entry.action == 'delete' %}bi-trash{% else %}bi-info-circle{% endif %}"></i>
                        </div>

                        <div class="timeline-content">
                            <!-- Action Header -->
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <strong>{{ entry.action|title }}</strong>
                                    <small class="text-muted d-block">
                                        {{ entry.timestamp|date:"M d, Y H:i" }}
                                    </small>
                                </div>
                                <small class="text-muted">
                                    {{ entry.timestamp|timesince }} ago
                                </small>
                            </div>

                            <!-- User Info -->
                            <small class="text-muted d-block mt-2">
                                <i class="bi bi-person"></i> {{ entry.user }}
                                {% if entry.ip_address %}
                                    <br>
                                    <i class="bi bi-cloud"></i> {{ entry.ip_address }}
                                {% endif %}
                            </small>

                            <!-- Changes Details -->
                            {% if entry.changes %}
                                <div class="mt-2 p-2 bg-light rounded small">
                                    {% for key, value in entry.changes.items %}
                                        <div class="mb-1">
                                            <strong>{{ key|title }}:</strong> {{ value }}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <style>
                .timeline {
                    position: relative;
                    padding: 20px;
                }

                .timeline-item {
                    display: flex;
                    margin-bottom: 30px;
                    position: relative;
                }

                .timeline-marker {
                    width: 40px;
                    height: 40px;
                    background: #e9ecef;
                    border: 2px solid #dee2e6;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-right: 20px;
                    flex-shrink: 0;
                    color: #6c757d;
                }

                .timeline-item.active .timeline-marker {
                    background: #0d6efd;
                    border-color: #0d6efd;
                    color: white;
                }

                .timeline-content {
                    flex: 1;
                    padding: 15px;
                    background: #f8f9fa;
                    border-radius: 4px;
                }

                .timeline-item:not(:last-child)::before {
                    content: '';
                    position: absolute;
                    left: 20px;
                    top: 50px;
                    width: 2px;
                    height: calc(100% - 50px);
                    background: #dee2e6;
                }
            </style>
        {% else %}
            <div class="p-4 text-center text-muted">
                <i class="bi bi-clock-history"></i>
                <p class="mb-0">No change history available</p>
            </div>
        {% endif %}
    </div>
</div>
