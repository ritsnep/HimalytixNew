{% extends "base.html" %}
{% block content %}
<h1>Finance Dashboard</h1>

{% if error %}
<div class="alert alert-warning">{{ error }}</div>
{% else %}
<div class="row">
  <div class="col">
    <h2>AP Aging</h2>
    <p>Total outstanding: {{ metrics.ap_aging.total }}</p>
  </div>
  <div class="col">
    <h2>AR Outstanding</h2>
    <p>{{ metrics.ar_aging.ar_outstanding }}</p>
  </div>
  <div class="col">
    <h2>Cash Balance</h2>
    <p>{{ metrics.cash.cash_balance }}</p>
  </div>
</div>

<div class="row">
  <div class="col">
    <h3>Budget Variance</h3>
    <p>Budget: {{ metrics.budget_variance.total_budget }}, Actual: {{ metrics.budget_variance.total_actual }}</p>
  </div>
  <div class="col">
    <h3>Assets</h3>
    <p>Book value: {{ metrics.assets.book_value }}</p>
  </div>
  <div class="col">
    <h3>Tax Liabilities</h3>
    <p>Payable: {{ metrics.tax_liabilities.total_payable }}, Receivable: {{ metrics.tax_liabilities.total_receivable }}</p>
  </div>
</div>

<div class="mt-4">
  <h3>Budget Variance Detail</h3>
  <table class="table">
    <thead><tr><th>Account</th><th>Budget</th><th>Actual</th><th>Variance</th></tr></thead>
    <tbody>
    {% for row in metrics.budget_variance.variances %}
    <tr>
      <td>{{ row.account }}</td>
      <td>{{ row.budget }}</td>
      <td>{{ row.actual }}</td>
      <td>{{ row.variance }}</td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<div class="mt-3">
  <a href="{{ export_url }}" class="btn btn-primary">Export CSV</a>
</div>
{% endif %}

{% endblock %}
