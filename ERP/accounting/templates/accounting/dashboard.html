{% extends "base.html" %}
{% block content %}
<h1>Finance Dashboard</h1>

{% if error %}
<div class="alert alert-warning">{{ error }}</div>
{% else %}
<div class="row">
  <div class="col">
    <h2>AP Aging</h2>
    <p>Total outstanding: {{ metrics.ap_aging.total }}</p>
  </div>
  <div class="col">
    <h2>AR Outstanding</h2>
    <p>{{ metrics.ar_aging.ar_outstanding }}</p>
  </div>
  <div class="col">
    <h2>Cash Balance</h2>
    <p>{{ metrics.cash.cash_balance }}</p>
  </div>
</div>

<div class="row mt-4">
  <div class="col">
    <h3>AP Aging Detail</h3>
    {% if metrics.ap_aging_detail.rows %}
    <div class="table-responsive">
      <table class="table table-sm table-bordered mb-0">
        <thead>
          <tr>
            <th>Vendor</th>
            {% for header in metrics.ap_aging_detail.headers %}
            <th>{{ header }}</th>
            {% endfor %}
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {% for row in metrics.ap_aging_detail.rows %}
          <tr>
            <td>{{ row.vendor_name }}</td>
            {% for amount in row.buckets %}
            <td>{{ amount }}</td>
            {% endfor %}
            <td>{{ row.total }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-muted mb-0">No outstanding vendor balances at this time.</p>
    {% endif %}
  </div>
</div>

<div class="row">
  <div class="col">
    <h3>Budget Variance</h3>
    <p>Budget: {{ metrics.budget_variance.total_budget }}, Actual: {{ metrics.budget_variance.total_actual }}</p>
  </div>
  <div class="col">
    <h3>Assets</h3>
    <p>Book value: {{ metrics.assets.book_value }}</p>
  </div>
  <div class="col">
    <h3>Tax Liabilities</h3>
    <p>Payable: {{ metrics.tax_liabilities.total_payable }}, Receivable: {{ metrics.tax_liabilities.total_receivable }}</p>
  </div>
</div>

<div class="mt-4">
  <h3>Budget Variance Detail</h3>
  <table class="table">
    <thead><tr><th>Account</th><th>Budget</th><th>Actual</th><th>Variance</th></tr></thead>
    <tbody>
    {% for row in metrics.budget_variance.variances %}
    <tr>
      <td>{{ row.account }}</td>
      <td>{{ row.budget }}</td>
      <td>{{ row.actual }}</td>
      <td>{{ row.variance }}</td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<div class="mt-3">
  <a href="{{ export_url }}" class="btn btn-primary">Export CSV</a>
</div>
{% endif %}

{% endblock %}
